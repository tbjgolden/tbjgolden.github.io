@use "sass:math";

ol,
ul {
  list-style: none;
}
blockquote,
q {
  quotes: none;
}
blockquote::after,
blockquote::before,
q::after,
q::before {
  content: none;
}
textarea {
  resize: vertical;
  overflow: auto;
}
applet,
canvas,
img,
object,
svg,
video {
  max-width: 100%;
  height: auto;
}

/*! based on awsm.css github:igoradamenko/awsm.css */

//- Maps
$font-map: (
  "mono": (
    Consolas,
    "Lucida Console",
    Monaco,
    monospace,
  ),
  "sans": (
    "Manrope VF",
    Manrope,
    -apple-system,
    BlinkMacSystemFont,
    Roboto,
    "Helvetica Neue",
    sans-serif,
  ),
);

$size-map: (
  "font-min": 16px,
  "font-max": 16px,
  "line-height-min": 1.2,
  "line-height-max": 1.5,
  "width-min": 320px,
  "width-max": 640px,
);

//- Functions

$color-map: (
  "primary": #000,
  "secondary": #fff,
  "stealthy": #aaa,
  "light": #f2f2f2,
  "selection-base": #0064c1,
  "link": #0064c1,
  "link-hover": #f00000,
  "link-visited": #8d39d0,
  "alarm": #d00000,
);

@function font($key) {
  @return map-get($font-map, $key);
}

@function size($key) {
  @return map-get($size-map, $key);
}

@function color($key) {
  @return map-get($color-map, $key);
}

//- Mixins

@mixin placeholder {
  &::-moz-placeholder {
    @content;
  }

  &::-webkit-input-placeholder {
    @content;
  }

  &:-ms-input-placeholder {
    @content;
  }
}

//- Basic

.markdown {
  font-family: font("sans");
  font-size: 100%;
  line-height: size("line-height-max");
  color: color("primary");
  -webkit-overflow-scrolling: touch;
  font-size: size("font-min");

  :first-child {
    margin-top: 0;
  }

  :last-child {
    margin-bottom: 0;
  }

  @media (min-width: size("width-min")) {
    $font-size-diff: size("font-max") - size("font-min");
    $width-diff: size("width-max") - size("width-min");
    $ratio: math.div($font-size-diff, $width-diff);

    font-size: calc(
      #{size("font-min")} + #{$ratio} * (100vw - #{size("width-min")})
    );
  }

  @media (min-width: size("width-max")) {
    font-size: size("font-max");
  }

  strong {
    font-weight: 700;
    font-variation-settings: "wght" 700;
  }

  em {
    font-style: italic;
  }

  header,
  main,
  footer,
  article {
    position: relative;
    max-width: size("width-max");
    margin: 0 auto;
  }

  > header {
    margin-bottom: 3.5em;

    h1 {
      margin: 0;
      font-size: 1.5em;
    }

    p {
      margin: 0;
      font-size: 0.85em;
    }
  }

  > footer {
    margin-top: 6em;
    padding-bottom: 1.5em;
    text-align: center;
    font-size: 13px;
    color: color("stealthy");
  }
  nav {
    margin: 1em 0;

    ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    li {
      display: inline-block;
      margin-right: 1em;
      margin-bottom: 0.25em;
    }

    a {
      &:visited {
        color: color("link");
      }

      &:hover {
        color: color("link-hover");
      }
    }
  }

  ul,
  ol {
    margin-top: 0;
    padding-top: 0;
    padding-left: 2.5em;
    list-style: circle outside;

    li {
      display: list-item;

      + li {
        margin-top: 0.25em;
      }

      > details {
        margin: 0;
      }
    }
  }

  p {
    margin: 1em 0;

    + ul,
    + ol {
      margin-top: -0.75em;
    }
  }

  dd {
    margin-bottom: 1em;
    margin-left: 0;
    padding-left: 2.5em;
  }

  dt {
    font-weight: 700;
    font-variation-settings: "wght" 700;
  }

  blockquote {
    margin: 1em 0;
    padding-left: 1.5em;
    border-left: 2px solid color("light");
  }

  aside {
    margin: 0.5em 0;
    font-style: italic;
    color: color("stealthy");

    $shift: 200px;
    @media (min-width: size("width-max") + $shift * 2) {
      position: absolute;
      right: -$shift;
      width: $shift * 0.75;
      max-width: $shift * 0.75;
      margin: 0;
      padding-left: 0.5em;
      font-size: 0.8em;
      border-left: 2px solid color("light");
    }

    &:first-child {
      margin-top: 0;
    }

    &:last-child {
      margin-bottom: 0;
    }
  }

  section {
    + section {
      margin-top: 2em;
    }
  }

  //- Typography

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 1.25em 0 0.25em;
    font-weight: 600;
    font-variation-settings: "wght" 600;
    line-height: size("line-height-min");

    &:hover,
    &:focus {
      > a[href^="#"][id]:empty {
        opacity: 1;
      }
    }

    + p,
    + details {
      margin-top: 0.5em;
    }

    > a[href^="#"][id]:empty {
      position: absolute;
      left: -0.65em;
      opacity: 0;
      text-decoration: none;
      font-weight: 500;
      font-variation-settings: "wght" 500;
      line-height: 1;
      color: color("stealthy");

      @media (min-width: size("width-max")) {
        left: -0.8em;
      }

      &:target,
      &:hover,
      &:focus {
        opacity: 1;
        box-shadow: none;
        color: color("primary");
      }

      &:target:focus {
        // stylelint-disable-line selector-max-specificity
        outline: none;
      }

      &::before {
        content: "ยง\a0";
      }
    }
  }

  h1 {
    font-size: 2.5em;
  }

  h2 {
    font-size: 1.75em;
  }

  h3 {
    font-size: 1.25em;
  }

  h4 {
    font-size: 1.15em;
  }

  h5 {
    font-size: 1em;
  }

  h6 {
    margin-top: 1em;
    font-size: 1em;
    color: color("stealthy");
  }

  article {
    + article {
      margin-top: 4em;
    }

    header {
      p {
        font-size: 0.6em;
        color: color("stealthy");

        + h1,
        + h2 {
          margin-top: -0.25em;
        }
      }

      h1,
      h2 {
        + p {
          margin-top: 0.25em;
        }

        a {
          color: color("primary");

          &:visited {
            color: color("stealthy");

            &:hover {
              color: color("link-hover");
            }
          }
        }
      }
    }

    > footer {
      margin-top: 1.5em;
      font-size: 0.85em;
    }
  }

  a {
    color: color("link");

    &:visited {
      color: color("link-visited");
    }

    &:hover,
    &:active {
      outline-width: 0;
    }

    &:hover {
      color: color("link-hover");
    }

    abbr {
      font-size: 1em; // because when it set to .9em inside link in chrome it makes underlining thinner
    }
  }

  abbr {
    margin-right: -0.075em;
    text-decoration: none;
    hyphens: none;
    letter-spacing: 0.075em;
    font-size: 0.9em;
  }

  //- Media

  img,
  picture {
    display: block;
    max-width: 100%;
    margin: 0;
  }

  audio,
  video {
    width: 100%;
    max-width: 100%;
  }

  figure {
    margin: 1em 0 0.5em;
    padding: 0;

    + p {
      margin-top: 0.5em;
    }

    figcaption {
      opacity: 0.65;
      font-size: 0.85em;
    }
  }

  //- Tables

  table {
    $scrollBorderColor: rgba(color("primary"), 0.15);

    display: inline-block;
    border-spacing: 0;
    border-collapse: collapse;
    overflow-x: auto;
    max-width: 100%;
    text-align: left;
    vertical-align: top;
    background: linear-gradient($scrollBorderColor 0%, $scrollBorderColor 100%)
        0 0,
      linear-gradient($scrollBorderColor 0%, $scrollBorderColor 100%) 100% 0;
    background-attachment: scroll, scroll;
    background-size: 1px 100%, 1px 100%;
    background-repeat: no-repeat, no-repeat;

    caption {
      font-size: 0.9em;
      background: color("secondary");
    }

    td,
    th {
      padding: 0.35em 0.75em;
      vertical-align: top;
      font-size: 0.9em;
      border: 2px solid color("light");
      border-top: 0;
      border-left: 0;

      &:first-child {
        padding-left: 0;
        background-image: linear-gradient(
          to right,
          rgba(color("secondary"), 1) 50%,
          rgba(color("secondary"), 0) 100%
        );
        background-size: 2px 100%;
        background-repeat: no-repeat;
      }

      &:last-child {
        padding-right: 0;
        border-right: 0;
        background-image: linear-gradient(
          to left,
          rgba(color("secondary"), 1) 50%,
          rgba(color("secondary"), 0) 100%
        );
        background-position: 100% 0;
        background-size: 2px 100%;
        background-repeat: no-repeat;
      }

      &:only-child {
        background-image: linear-gradient(
            to right,
            rgba(color("secondary"), 1) 50%,
            rgba(color("secondary"), 0) 100%
          ),
          linear-gradient(
            to left,
            rgba(color("secondary"), 1) 50%,
            rgba(color("secondary"), 0) 100%
          );
        background-position: 0 0, 100% 0;
        background-size: 2px 100%, 2px 100%;
        background-repeat: no-repeat, no-repeat;
      }
    }

    th {
      line-height: size("line-height-min");
    }
  }

  //- Forms

  form {
    margin-right: auto;
    margin-left: auto;

    @media (min-width: size("width-max")) {
      max-width: 80%;
    }

    select,
    label {
      display: block;
    }

    label {
      &:not(:first-child) {
        margin-top: 1em;
      }
    }

    p {
      label {
        display: inline;

        + label {
          margin-left: 1em;
        }
      }
    }

    legend:first-child + label {
      margin-top: 0;
    }

    select,
    input[type],
    textarea {
      margin-bottom: 1em;
    }

    input {
      &[type="checkbox"],
      &[type="radio"] {
        margin-bottom: 0;
      }
    }
  }

  fieldset {
    margin: 0;
    padding: 0.5em 1em;
    border: 2px solid color("light");
  }

  legend {
    color: color("stealthy");
  }

  @mixin inputs-buttons {
    outline: none;
    box-sizing: border-box;
    height: 2em;
    margin: 0;
    padding: calc(0.25em - 2px) 0.5em;
    font-family: inherit;
    font-size: 1em;
    border: 2px solid color("light");
    border-radius: 2px;
    background: color("secondary");
    color: color("primary");

    &:focus {
      border: 2px solid color("light");
    }
  }

  @mixin inputs {
    @include inputs-buttons;

    display: block;
    width: 100%;
    line-height: calc(
      2em - 2px * 2 - (0.25em - 2px) * 2
    ); // height - 2 * border - 2 * paddingHrz
    appearance: none; // prevents strange appearances, such as date selector-like in ios safari

    @include placeholder {
      color: color("stealthy");
    }
  }

  @mixin buttons {
    @include inputs-buttons;

    display: inline-block;
    width: auto;
    background: color("light");
    color: color("primary");
    cursor: pointer;

    &:not([disabled]):hover {
      border: 2px solid color("light");
    }

    &:active {
      background-color: color("stealthy");
    }

    &[disabled] {
      color: color("stealthy");
      cursor: not-allowed;
    }
  }

  button {
    @include buttons;
  }

  select {
    @include buttons;

    @mixin select-background-image($color) {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3 2'%3E%3Cpath fill='rgb(#{red($color)}, #{green($color)}, #{blue($color)})' fill-rule='nonzero' d='M1.5 2L3 0H0z'/%3E%3C/svg%3E");
    }

    padding-right: 1.2em;
    background-position: top 55% right 0.35em;
    background-size: 0.5em;
    background-repeat: no-repeat;
    appearance: none;

    @include select-background-image(color("stealthy"));

    &:focus,
    &:hover {
      @include select-background-image(color("primary"));
    }
  }

  input {
    &[type="text"],
    &[type="password"],
    &[type^="date"],
    &[type="email"],
    &[type="number"],
    &[type="search"],
    &[type="tel"],
    &[type="time"],
    &[type="month"],
    &[type="week"],
    &[type="url"] {
      @include inputs;
    }

    &[type="submit"],
    &[type="button"],
    &[type="reset"] {
      @include buttons;

      appearance: none;
    }

    &[type="color"] {
      @include inputs;

      width: 6em;

      &:hover {
        border: 2px solid color("light");
      }
    }

    &[type="file"] {
      @include buttons;

      display: block;
      width: 100%;
      height: auto;
      padding: 0.75em 0.5em;
      font-size: 12px; // otherwise browsers change only text size but not button size
      line-height: 1;
    }

    &[type="checkbox"],
    &[type="radio"] {
      margin: -0.2em 0.75em 0 0;
      vertical-align: middle;
    }
  }

  textarea {
    @include inputs;

    height: 4.5em;
    resize: vertical;
    padding-top: 0.5em;
    padding-bottom: 0.5em;
  }

  output {
    display: block;
  }

  //- Code

  code,
  kbd,
  var,
  samp {
    font-family: font("mono");
    font-style: normal;
    background: rgba(127, 127, 127, 0.1);
  }

  pre {
    $scrollBorderColor: rgba(color("primary"), 0.15);

    overflow-x: auto;
    font-size: 0.8em;
    background: linear-gradient($scrollBorderColor 0%, $scrollBorderColor 100%)
        0 0,
      linear-gradient($scrollBorderColor 0%, $scrollBorderColor 100%) 100% 0;
    background-attachment: scroll, scroll;
    background-size: 2px 100%, 2px 100%;
    background-repeat: no-repeat, no-repeat;

    > code {
      display: inline-block;
      overflow-x: visible;
      box-sizing: border-box;
      min-width: 100%;
      border-right: 3px solid color("light"); // 3px 'cause of bad chrome rendering
      border-left: 2px solid color("light");
      padding: 0 1.5em;
      background: none;
    }
  }

  //- Misc.

  hr {
    height: 2px;
    margin: 1.5em 0;
    border: 0;
    background: color("stealthy");
  }

  details {
    margin: 1em 1em .5em 1em;
    padding: 0 .5em .5em .5em;
    position: relative;
    font-size: 90%;

    :nth-child(2) {
      margin-top: 0;
    }

    summary {
      position: relative;
      font-size: 111%;
    }

    summary::before {
      position: absolute;
      left: -1.5em;
      content: "\2795";
    }

    table {
      background: none;

      caption {
        background: color("secondary");
      }

      th {
        font-weight: bold;
        font-variation-settings: 'wght' 700;
      }

      td,
      th {
        border: 1px solid color("stealthy");

        &:first-child {
          border-left-color: transparent;
          background-image: none;
        }

        &:last-child {
          background-image: linear-gradient(
            to left,
            rgba(color("light"), 1) 50%,
            rgba(color("light"), 0) 100%
          );
        }

        &:only-child {
          background-image: linear-gradient(
              to right,
              rgba(color("light"), 1) 50%,
              rgba(color("light"), 0) 100%
            ),
            linear-gradient(
              to left,
              rgba(color("light"), 1) 50%,
              rgba(color("light"), 0) 100%
            );
        }
      }

      th {
        line-height: size("line-height-min");
      }
    }


    &[open] {
      margin-bottom: 1.5em;

      &::before {
        position: absolute;
        content: "";
        display: block;
        top: 2.4em;
        right: 0;
        bottom: 0;
        left: 0;
        background: color("light");
        z-index: 0;
      }

      > * {
        position: relative;
        z-index: 1;
      }

      summary {
        margin-bottom: 1em;

        &::before {
          content: "\2796";
        }
      }
    }
  }

  summary {
    display: inline-block;
    font-weight: 700;
    font-variation-settings: "wght" 700;
    border-bottom: 2px dashed;
    cursor: pointer;

    &::-webkit-details-marker {
      display: none;
    }
  }

  noscript {
    color: color("alarm");
  }

  ::selection {
    background: rgba(color("selection-base"), 0.25);
  }
}
